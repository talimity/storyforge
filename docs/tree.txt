.
├── apps
│ ├── backend
│ │ ├── package.json
│ │ ├── scripts
│ │ │ └── test-completion.ts
│ │ ├── src
│ │ │ ├── api
│ │ │ │ ├── app-context.ts
│ │ │ │ ├── app-router.ts
│ │ │ │ ├── assets.ts
│ │ │ │ ├── engine-error-to-trpc.ts
│ │ │ │ ├── index.ts
│ │ │ │ ├── openapi.ts
│ │ │ │ ├── register.ts
│ │ │ │ ├── routers
│ │ │ │ │ ├── characters.ts
│ │ │ │ │ ├── chat-import.ts
│ │ │ │ │ ├── debug.ts
│ │ │ │ │ ├── play.ts
│ │ │ │ │ └── scenarios.ts
│ │ │ │ ├── service-error-to-trpc.ts
│ │ │ │ ├── sse.ts
│ │ │ │ └── trpc-ui.ts
│ │ │ ├── app-context-plugin.ts
│ │ │ ├── config.ts
│ │ │ ├── engine
│ │ │ │ ├── context
│ │ │ │ │ ├── context-builder.test.ts
│ │ │ │ │ └── context-builder.ts
│ │ │ │ ├── engine-error.ts
│ │ │ │ ├── invariants
│ │ │ │ │ ├── turn-content.ts
│ │ │ │ │ ├── turn-progression.ts
│ │ │ │ │ └── turn.ts
│ │ │ │ └── scenario-runtime.ts
│ │ │ ├── inference
│ │ │ │ ├── generation-context-adapter.ts
│ │ │ │ ├── provider-manager.ts
│ │ │ │ └── providers
│ │ │ │ ├── base-provider.ts
│ │ │ │ ├── deepseek.ts
│ │ │ │ ├── mock.ts
│ │ │ │ └── openrouter.ts
│ │ │ ├── logging.ts
│ │ │ ├── main.ts
│ │ │ ├── service-error.ts
│ │ │ ├── services
│ │ │ │ ├── chapter
│ │ │ │ ├── character
│ │ │ │ │ ├── character.queries.ts
│ │ │ │ │ ├── character-service.ts
│ │ │ │ │ ├── character.transforms.ts
│ │ │ │ │ └── utils
│ │ │ │ │ ├── chara-asset-helpers.ts
│ │ │ │ │ ├── face-detection.ts
│ │ │ │ │ └── parse-tavern-card.ts
│ │ │ │ ├── chat-import
│ │ │ │ │ └── chat-import.service.ts
│ │ │ │ ├── context-loader.ts
│ │ │ │ ├── intent.service.ts
│ │ │ │ ├── scenario
│ │ │ │ │ ├── scenario.queries.ts
│ │ │ │ │ ├── scenario.service.ts
│ │ │ │ │ └── scenario.transforms.ts
│ │ │ │ ├── selectors.ts
│ │ │ │ └── turn
│ │ │ │ ├── timeline.service.test.ts
│ │ │ │ ├── timeline.service.ts
│ │ │ │ ├── turn-content.service.ts
│ │ │ │ ├── turn.queries.ts
│ │ │ │ └── utils
│ │ │ │  └── mutation-planner.ts
│ │ │ ├── test
│ │ │ │ ├── characters.integration.test.ts
│ │ │ │ ├── fixtures.ts
│ │ │ │ ├── scenarios.integration.test.ts
│ │ │ │ └── setup.ts
│ │ │ ├── types
│ │ │ │ └── fastify.d.ts
│ │ │ └── types.ts
│ │ ├── tsconfig.json
│ │ ├── tsconfig.test.json
│ │ └── vitest.config.ts
│ └── frontend
│ ├── biome.json
│ ├── index.html
│ ├── package.json
│ ├── public
│ │ └── static
│ │ └── logo.svg
│ ├── src
│ │ ├── components
│ │ │ ├── app-shell.tsx
│ │ │ ├── color-mode-toggle.tsx
│ │ │ ├── common
│ │ │ │ └── error-boundary.tsx
│ │ │ ├── dialogs
│ │ │ │ ├── character-delete.tsx
│ │ │ │ ├── character-import.tsx
│ │ │ │ ├── chat-import
│ │ │ │ │ ├── character-mapping-step.tsx
│ │ │ │ │ ├── chat-import-dialog.tsx
│ │ │ │ │ ├── chat-upload-step.tsx
│ │ │ │ │ ├── file-validation.ts
│ │ │ │ │ ├── index.ts
│ │ │ │ │ └── use-chat-import.ts
│ │ │ │ ├── discard-changes.tsx
│ │ │ │ ├── scenario-delete.tsx
│ │ │ │ ├── turn-delete.tsx
│ │ │ │ └── unsaved-changes.tsx
│ │ │ ├── features
│ │ │ │ ├── character
│ │ │ │ │ ├── character-card.tsx
│ │ │ │ │ ├── character-form.tsx
│ │ │ │ │ ├── character-image-field.tsx
│ │ │ │ │ ├── character-list-item.tsx
│ │ │ │ │ ├── character-pile.tsx
│ │ │ │ │ ├── character-selector.tsx
│ │ │ │ │ ├── compact-character-card.tsx
│ │ │ │ │ └── use-character-actions.ts
│ │ │ │ ├── player
│ │ │ │ │ ├── intent-panel
│ │ │ │ │ │ ├── direct-control-panel.tsx
│ │ │ │ │ │ ├── intent-panel.tsx
│ │ │ │ │ │ ├── quick-actions-panel.tsx
│ │ │ │ │ │ └── story-constraints-panel.tsx
│ │ │ │ │ ├── player-layout.tsx
│ │ │ │ │ ├── player-shell.tsx
│ │ │ │ │ ├── player-widget-sidebar.tsx
│ │ │ │ │ ├── turn-history
│ │ │ │ │ │ ├── character-starter-selector.tsx
│ │ │ │ │ │ ├── index.ts
│ │ │ │ │ │ ├── turn-history.tsx
│ │ │ │ │ │ └── turn-item.tsx
│ │ │ │ │ └── widgets
│ │ │ │ │ ├── characters-widget.tsx
│ │ │ │ │ ├── director-widget.tsx
│ │ │ │ │ ├── index.ts
│ │ │ │ │ ├── scene-widget.tsx
│ │ │ │ │ ├── tools-widget.tsx
│ │ │ │ │ └── widget-panels.tsx
│ │ │ │ └── scenario
│ │ │ │ ├── scenario-card.tsx
│ │ │ │ ├── scenario-form.tsx
│ │ │ │ └── use-scenario-actions.ts
│ │ │ ├── logo.tsx
│ │ │ ├── sidebar-link.tsx
│ │ │ ├── sidebar.tsx
│ │ │ └── ui
│ │ │ ├── action-bar.tsx
│ │ │ ├── avatar.tsx
│ │ │ ├── button.tsx
│ │ │ ├── checkbox.tsx
│ │ │ ├── close-button.tsx
│ │ │ ├── dialog.tsx
│ │ │ ├── empty-state.tsx
│ │ │ ├── field.tsx
│ │ │ ├── index.ts
│ │ │ ├── page-header.tsx
│ │ │ ├── prose.tsx
│ │ │ ├── radio.tsx
│ │ │ ├── select.tsx
│ │ │ ├── split-button.tsx
│ │ │ ├── switch.tsx
│ │ │ ├── toaster.tsx
│ │ │ ├── toggle-tip.tsx
│ │ │ └── tooltip.tsx
│ │ ├── lib
│ │ │ ├── hooks
│ │ │ │ ├── use-active-scenario.ts
│ │ │ │ ├── use-auto-load-more.tsx
│ │ │ │ ├── use-character-search.ts
│ │ │ │ ├── use-image-field.ts
│ │ │ │ ├── use-scenario-environment.ts
│ │ │ │ ├── use-scenario-intent.ts
│ │ │ │ ├── use-scenario-timeline.ts
│ │ │ │ ├── use-turn-actions.tsx
│ │ │ │ └── use-unsaved-changes-protection.ts
│ │ │ ├── providers
│ │ │ │ └── scenario-provider.tsx
│ │ │ ├── providers.tsx
│ │ │ ├── query-client.ts
│ │ │ ├── stores
│ │ │ ├── trpc.ts
│ │ │ └── utils
│ │ │ ├── error-handling.ts
│ │ │ └── formatting.ts
│ │ ├── main.tsx
│ │ ├── pages
│ │ │ ├── agents.tsx
│ │ │ ├── character-create.tsx
│ │ │ ├── character-edit.tsx
│ │ │ ├── character-library.tsx
│ │ │ ├── models.tsx
│ │ │ ├── player.tsx
│ │ │ ├── scenario-create.tsx
│ │ │ ├── scenario-edit.tsx
│ │ │ ├── scenario-library.tsx
│ │ │ ├── settings.tsx
│ │ │ └── theme-demo.tsx
│ │ ├── router.tsx
│ │ ├── stores
│ │ │ └── scenario-store.ts
│ │ ├── theme.ts
│ │ └── vite-env.d.ts
│ ├── tsconfig.json
│ ├── tsconfig.node.json
│ └── vite.config.ts
├── biome.json
├── biome-rules
│ ├── no-async-sqlite-tx.grit
│ └── no-console-use-pino.grit
├── docs
│ └── tree.txt
├── flake.lock
├── flake.nix
├── package.json
├── packages
│ ├── config
│ │ ├── package.json
│ │ ├── src
│ │ │ └── index.ts
│ │ └── tsconfig.json
│ ├── db
│ │ ├── drizzle.config.ts
│ │ ├── package.json
│ │ ├── scripts
│ │ │ └── db-query.ts
│ │ ├── src
│ │ │ ├── client.ts
│ │ │ ├── config.ts
│ │ │ ├── index.ts
│ │ │ ├── migrate.ts
│ │ │ ├── migrations
│ │ │ ├── relations.ts
│ │ │ └── schema
│ │ │ ├── chapters.ts
│ │ │ ├── character-examples.ts
│ │ │ ├── character-starters.ts
│ │ │ ├── characters.ts
│ │ │ ├── index.ts
│ │ │ ├── scenario-participants.ts
│ │ │ ├── scenarios.ts
│ │ │ ├── turn-layers.ts
│ │ │ └── turns.ts
│ │ └── tsconfig.json
│ ├── schemas
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── contracts
│ │ │ │ ├── character.ts
│ │ │ │ ├── chat-import.ts
│ │ │ │ ├── debug.ts
│ │ │ │ ├── play.ts
│ │ │ │ └── scenario.ts
│ │ │ ├── index.ts
│ │ │ └── utils
│ │ │ └── data-uri-validation.ts
│ │ └── tsconfig.json
│ ├── utils
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── assert-defined.ts
│ │ │ ├── fractional-order.ts
│ │ │ ├── index.ts
│ │ │ ├── is-defined.ts
│ │ │ ├── lexo-order.ts
│ │ │ └── result.ts
│ │ └── tsconfig.json
│ └── yolo-onnx
│ ├── models
│ │ ├── nms-yolov8.onnx
│ │ └── yolov8n-face.onnx
│ ├── package.json
│ ├── src
│ │ └── index.ts
│ ├── test-face-detection.ts
│ └── tsconfig.json
├── pnpm-lock.yaml
├── pnpm-workspace.yaml
├── todos
│ └── journals
├── tsconfig.base.json
└── tsconfig.json

66 directories, 219 files
