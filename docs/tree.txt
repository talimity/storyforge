.
├── apps
│ ├── backend
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── api
│ │ │ │ ├── app-router.ts
│ │ │ │ ├── assets.ts
│ │ │ │ ├── engine-error-to-trpc.ts
│ │ │ │ ├── index.ts
│ │ │ │ ├── openapi.ts
│ │ │ │ ├── register.ts
│ │ │ │ ├── routers
│ │ │ │ │ ├── characters.ts
│ │ │ │ │ ├── chat-import.ts
│ │ │ │ │ ├── play.ts
│ │ │ │ │ ├── providers.ts
│ │ │ │ │ ├── scenarios.ts
│ │ │ │ │ └── templates.ts
│ │ │ │ ├── service-error-to-trpc.ts
│ │ │ │ └── trpc-context.ts
│ │ │ ├── config.ts
│ │ │ ├── engine-error.ts
│ │ │ ├── logging.ts
│ │ │ ├── main.ts
│ │ │ ├── resources.ts
│ │ │ ├── service-error.ts
│ │ │ ├── services
│ │ │ │ ├── character
│ │ │ │ │ ├── character.queries.ts
│ │ │ │ │ ├── character-service.ts
│ │ │ │ │ ├── character.transforms.ts
│ │ │ │ │ └── utils
│ │ │ │ │   ├── chara-asset-helpers.ts
│ │ │ │ │   ├── face-detection.ts
│ │ │ │ │   └── parse-tavern-card.ts
│ │ │ │ ├── chat-import
│ │ │ │ │ └── chat-import.service.ts
│ │ │ │ ├── intent
│ │ │ │ │ └── turngen-context-builder.ts
│ │ │ │ ├── macro-replacement.ts
│ │ │ │ ├── provider
│ │ │ │ │ ├── provider.queries.ts
│ │ │ │ │ └── provider.service.ts
│ │ │ │ ├── scenario
│ │ │ │ │ ├── scenario.queries.ts
│ │ │ │ │ ├── scenario.service.test.ts
│ │ │ │ │ ├── scenario.service.ts
│ │ │ │ │ └── scenario.transforms.ts
│ │ │ │ ├── template
│ │ │ │ │ ├── template.queries.ts
│ │ │ │ │ ├── template.service.ts
│ │ │ │ │ └── utils
│ │ │ │ │   └── marshalling.ts
│ │ │ │ ├── timeline
│ │ │ │ │ ├── invariants
│ │ │ │ │ │ ├── turn-content.ts
│ │ │ │ │ │ ├── turn-progression.ts
│ │ │ │ │ │ └── turn.ts
│ │ │ │ │ ├── timeline.queries.ts
│ │ │ │ │ ├── timeline.service.test.ts
│ │ │ │ │ ├── timeline.service.ts
│ │ │ │ │ └── utils
│ │ │ │ │   └── mutation-planner.ts
│ │ │ │ └── turn
│ │ │ │   └── turn-content.service.ts
│ │ │ ├── test
│ │ │ │ ├── characters.integration.test.ts
│ │ │ │ ├── fixtures.ts
│ │ │ │ ├── scenarios.integration.test.ts
│ │ │ │ └── setup.ts
│ │ │ └── types.ts
│ │ ├── tsconfig.build.json
│ │ ├── tsconfig.json
│ │ └── vitest.config.ts
│ └── frontend
│   ├── biome.json
│   ├── index.html
│   ├── package.json
│   ├── public
│   │ └── static
│   │   └── logo.svg
│   ├── src
│   │ ├── components
│   │ │ ├── app-shell.tsx
│   │ │ ├── color-mode-toggle.tsx
│   │ │ ├── common
│   │ │ │ └── error-boundary.tsx
│   │ │ ├── dialogs
│   │ │ │ ├── character-delete.tsx
│   │ │ │ ├── character-import.tsx
│   │ │ │ ├── chat-import
│   │ │ │ │ ├── character-mapping-step.tsx
│   │ │ │ │ ├── chat-import-dialog.tsx
│   │ │ │ │ ├── chat-upload-step.tsx
│   │ │ │ │ ├── file-validation.ts
│   │ │ │ │ ├── index.ts
│   │ │ │ │ └── use-chat-import.ts
│   │ │ │ ├── discard-changes.tsx
│   │ │ │ ├── scenario-delete.tsx
│   │ │ │ ├── template-delete.tsx
│   │ │ │ ├── template-duplicate.tsx
│   │ │ │ ├── template-import.tsx
│   │ │ │ ├── turn-delete.tsx
│   │ │ │ └── unsaved-changes.tsx
│   │ │ ├── features
│   │ │ │ ├── character
│   │ │ │ │ ├── character-card.tsx
│   │ │ │ │ ├── character-form.tsx
│   │ │ │ │ ├── character-image-field.tsx
│   │ │ │ │ ├── character-list-item.tsx
│   │ │ │ │ ├── character-pile.tsx
│   │ │ │ │ ├── character-selector.tsx
│   │ │ │ │ ├── compact-character-card.tsx
│   │ │ │ │ └── use-character-actions.ts
│   │ │ │ ├── inference
│   │ │ │ │ ├── create-model-profile-dialog.tsx
│   │ │ │ │ ├── create-provider-dialog.tsx
│   │ │ │ │ ├── delete-model-profile-dialog.tsx
│   │ │ │ │ ├── delete-provider-dialog.tsx
│   │ │ │ │ ├── edit-model-profile-dialog.tsx
│   │ │ │ │ ├── edit-provider-dialog.tsx
│   │ │ │ │ ├── model-profile-card.tsx
│   │ │ │ │ ├── model-profile-form.tsx
│   │ │ │ │ ├── provider-card.tsx
│   │ │ │ │ ├── provider-form.tsx
│   │ │ │ │ ├── providers-tab.tsx
│   │ │ │ │ └── test-connection-button.tsx
│   │ │ │ ├── player
│   │ │ │ │ ├── intent-panel
│   │ │ │ │ │ ├── direct-control-panel.tsx
│   │ │ │ │ │ ├── intent-panel.tsx
│   │ │ │ │ │ ├── quick-actions-panel.tsx
│   │ │ │ │ │ └── story-constraints-panel.tsx
│   │ │ │ │ ├── player-layout.tsx
│   │ │ │ │ ├── player-shell.tsx
│   │ │ │ │ ├── player-widget-sidebar.tsx
│   │ │ │ │ ├── turn-history
│   │ │ │ │ │ ├── character-starter-selector.tsx
│   │ │ │ │ │ ├── index.ts
│   │ │ │ │ │ ├── turn-history.tsx
│   │ │ │ │ │ └── turn-item.tsx
│   │ │ │ │ └── widgets
│   │ │ │ │   ├── characters-widget.tsx
│   │ │ │ │   ├── director-widget.tsx
│   │ │ │ │   ├── index.ts
│   │ │ │ │   ├── scene-widget.tsx
│   │ │ │ │   ├── tools-widget.tsx
│   │ │ │ │   └── widget-panels.tsx
│   │ │ │ ├── scenario
│   │ │ │ │ ├── participant-manager.tsx
│   │ │ │ │ ├── scenario-card.tsx
│   │ │ │ │ ├── scenario-form.tsx
│   │ │ │ │ └── use-scenario-actions.ts
│   │ │ │ └── templates
│   │ │ │   ├── builder
│   │ │ │   │ ├── builder-utils.ts
│   │ │ │   │ ├── index.ts
│   │ │ │   │ ├── layout-builder.tsx
│   │ │ │   │ ├── layout-node-card.tsx
│   │ │ │   │ ├── nodes
│   │ │ │   │ │ ├── message-node-edit.tsx
│   │ │ │   │ │ ├── message-node-view.tsx
│   │ │ │   │ │ ├── node-frame.tsx
│   │ │ │   │ │ ├── slot-reference-edit.tsx
│   │ │ │   │ │ └── slot-reference-view.tsx
│   │ │ │   │ ├── parameter-inputs.tsx
│   │ │ │   │ ├── slot-validation.ts
│   │ │ │   │ ├── template-metadata.tsx
│   │ │ │   │ ├── template-string-editor.tsx
│   │ │ │   │ └── use-layout-dnd.ts
│   │ │ │   ├── preview
│   │ │ │   │ └── template-preview.tsx
│   │ │ │   ├── recipes
│   │ │ │   │ ├── param-coercion.test.ts
│   │ │ │   │ ├── param-coercion.ts
│   │ │ │   │ ├── registry.ts
│   │ │ │   │ └── turngen
│   │ │ │   │   ├── characters-recipe.ts
│   │ │ │   │   └── timeline-recipe.ts
│   │ │ │   ├── template-card.tsx
│   │ │ │   ├── template-form-schema.ts
│   │ │ │   ├── template-form.tsx
│   │ │ │   ├── template-list-item.tsx
│   │ │ │   ├── types.ts
│   │ │ │   ├── use-template-actions.ts
│   │ │ │   └── utils
│   │ │ │       ├── compile-draft.test.ts
│   │ │ │       ├── compile-draft.ts
│   │ │ │       └── template-conversion.ts
│   │ │ ├── logo.tsx
│   │ │ ├── sidebar-link.tsx
│   │ │ ├── sidebar.tsx
│   │ │ └── ui
│   │ │   ├── action-bar.tsx
│   │ │   ├── avatar.tsx
│   │ │   ├── button.tsx
│   │ │   ├── checkbox.tsx
│   │ │   ├── close-button.tsx
│   │ │   ├── dialog.tsx
│   │ │   ├── empty-state.tsx
│   │ │   ├── field.tsx
│   │ │   ├── index.ts
│   │ │   ├── page-header.tsx
│   │ │   ├── prose.tsx
│   │ │   ├── radio.tsx
│   │ │   ├── select.tsx
│   │ │   ├── split-button.tsx
│   │ │   ├── switch.tsx
│   │ │   ├── toaster.tsx
│   │ │   ├── toggle-tip.tsx
│   │ │   └── tooltip.tsx
│   │ ├── lib
│   │ │ ├── hooks
│   │ │ │ ├── use-active-scenario.ts
│   │ │ │ ├── use-auto-load-more.tsx
│   │ │ │ ├── use-character-search.ts
│   │ │ │ ├── use-debounced-callback.ts
│   │ │ │ ├── use-image-field.ts
│   │ │ │ ├── use-scenario-environment.ts
│   │ │ │ ├── use-scenario-intent.ts
│   │ │ │ ├── use-scenario-timeline.ts
│   │ │ │ ├── use-turn-actions.tsx
│   │ │ │ └── use-unsaved-changes-protection.ts
│   │ │ ├── non-bubbling-handler.tsx
│   │ │ ├── providers
│   │ │ │ └── scenario-provider.tsx
│   │ │ ├── providers.tsx
│   │ │ ├── query-client.ts
│   │ │ ├── stores
│   │ │ ├── trpc.ts
│   │ │ └── utils
│   │ │   ├── error-handling.ts
│   │ │   └── formatting.ts
│   │ ├── main.tsx
│   │ ├── pages
│   │ │ ├── agents.tsx
│   │ │ ├── character-create.tsx
│   │ │ ├── character-edit.tsx
│   │ │ ├── character-library.tsx
│   │ │ ├── models.tsx
│   │ │ ├── player.tsx
│   │ │ ├── scenario-create.tsx
│   │ │ ├── scenario-edit.tsx
│   │ │ ├── scenario-library.tsx
│   │ │ ├── settings.tsx
│   │ │ ├── template-create.tsx
│   │ │ ├── template-edit.tsx
│   │ │ ├── template-library.tsx
│   │ │ ├── template-task-select.tsx
│   │ │ └── theme-demo.tsx
│   │ ├── router.tsx
│   │ ├── stores
│   │ │ ├── scenario-store.ts
│   │ │ └── template-builder-store.ts
│   │ ├── test
│   │ │ ├── setup.ts
│   │ │ └── test-utils.tsx
│   │ ├── theme.ts
│   │ └── vite-env.d.ts
│   ├── tsconfig.json
│   ├── tsconfig.node.json
│   ├── vite.config.ts
│   └── vitest.config.ts
├── biome.json
├── biome-rules
│ └── no-console-use-pino.grit
├── docs
│ └── tree.txt
├── flake.lock
├── flake.nix
├── package.json
├── packages
│ ├── config
│ │ ├── package.json
│ │ ├── src
│ │ │ └── index.ts
│ │ ├── tsconfig.build.json
│ │ └── tsconfig.json
│ ├── db
│ │ ├── drizzle.config.ts
│ │ ├── package.json
│ │ ├── scripts
│ │ │ └── db-query.ts
│ │ ├── src
│ │ │ ├── client.ts
│ │ │ ├── config.ts
│ │ │ ├── index.ts
│ │ │ ├── migrate.ts
│ │ │ ├── migrations
│ │ │ ├── relations.ts
│ │ │ ├── schema
│ │ │ │ ├── chapters.ts
│ │ │ │ ├── character-examples.ts
│ │ │ │ ├── character-starters.ts
│ │ │ │ ├── characters.ts
│ │ │ │ ├── index.ts
│ │ │ │ ├── intent-effects.ts
│ │ │ │ ├── intents.ts
│ │ │ │ ├── model-profiles.ts
│ │ │ │ ├── prompt-templates.ts
│ │ │ │ ├── provider-config.ts
│ │ │ │ ├── scenario-participants.ts
│ │ │ │ ├── scenarios.ts
│ │ │ │ ├── turn-layers.ts
│ │ │ │ ├── turns.ts
│ │ │ │ └── workflows.ts
│ │ │ └── utils.ts
│ │ ├── tsconfig.build.json
│ │ └── tsconfig.json
│ ├── gentasks
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── index.ts
│ │ │ ├── runner
│ │ │ │ ├── async-queue.ts
│ │ │ │ ├── index.ts
│ │ │ │ ├── registry-factory.ts
│ │ │ │ ├── runner.test.ts
│ │ │ │ ├── runner.ts
│ │ │ │ ├── run-store.ts
│ │ │ │ ├── schemas.ts
│ │ │ │ └── types.ts
│ │ │ ├── schemas.ts
│ │ │ ├── tasks
│ │ │ │ ├── chapter-summarization.ts
│ │ │ │ ├── turn-generation.ts
│ │ │ │ └── writing-assistant.ts
│ │ │ └── types.ts
│ │ ├── tsconfig.build.json
│ │ ├── tsconfig.json
│ │ └── vitest.config.ts
│ ├── inference
│ │ ├── docs
│ │ │ └── provider-specs
│ │ │   └── deepseek-openapi.yaml
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── errors.ts
│ │ │ ├── index.ts
│ │ │ ├── preflights.ts
│ │ │ ├── provider-factory.ts
│ │ │ ├── providers
│ │ │ │ ├── base.ts
│ │ │ │ ├── deepseek.ts
│ │ │ │ ├── mock.ts
│ │ │ │ ├── openai-compatible.ts
│ │ │ │ └── openrouter.ts
│ │ │ ├── transforms.ts
│ │ │ ├── types.ts
│ │ │ └── utils
│ │ │   └── sse.ts
│ │ ├── tsconfig.build.json
│ │ └── tsconfig.json
│ ├── prompt-rendering
│ │ ├── biome.json
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── budget-manager.test.ts
│ │ │ ├── budget-manager.ts
│ │ │ ├── compiler.test.ts
│ │ │ ├── compiler.ts
│ │ │ ├── condition-evaluator.test.ts
│ │ │ ├── condition-evaluator.ts
│ │ │ ├── data-ref-resolver.test.ts
│ │ │ ├── data-ref-resolver.ts
│ │ │ ├── errors.ts
│ │ │ ├── index.ts
│ │ │ ├── layout-assembler.test.ts
│ │ │ ├── layout-assembler.ts
│ │ │ ├── leaf-compiler.test.ts
│ │ │ ├── leaf-compiler.ts
│ │ │ ├── plan-executor.test.ts
│ │ │ ├── plan-executor.ts
│ │ │ ├── renderer.test.ts
│ │ │ ├── renderer.ts
│ │ │ ├── response-transformer.test.ts
│ │ │ ├── response-transformer.ts
│ │ │ ├── schemas.test.ts
│ │ │ ├── schemas.ts
│ │ │ ├── slot-executor.test.ts
│ │ │ ├── slot-executor.ts
│ │ │ ├── source-linter.test.ts
│ │ │ ├── source-linter.ts
│ │ │ ├── source-registry.test.ts
│ │ │ ├── source-registry.ts
│ │ │ ├── test
│ │ │ │ ├── fixtures
│ │ │ │ │ ├── contexts
│ │ │ │ │ │ ├── index.ts
│ │ │ │ │ │ └── turn-generation-contexts.ts
│ │ │ │ │ ├── index.ts
│ │ │ │ │ ├── registries
│ │ │ │ │ │ ├── index.ts
│ │ │ │ │ │ └── turn-generation-registry.ts
│ │ │ │ │ ├── templates
│ │ │ │ │ │ ├── complex-template.json
│ │ │ │ │ │ ├── minimal-template.json
│ │ │ │ │ │ ├── multi-slot-template.json
│ │ │ │ │ │ └── spec
│ │ │ │ │ │   ├── tpl_turn_planner_v1.json
│ │ │ │ │ │   ├── tpl_turn_writer_from_plan_v1.json
│ │ │ │ │ │   └── tpl_turn_writer_v2.json
│ │ │ │ │ ├── test-contexts.ts
│ │ │ │ │ └── test-registries.ts
│ │ │ │ └── integration
│ │ │ │   ├── assistant-prefix.test.ts
│ │ │ │   ├── budget-cutoff.test.ts
│ │ │ │   ├── conditional-slots.test.ts
│ │ │ │   ├── determinism.test.ts
│ │ │ │   ├── slot-priority.test.ts
│ │ │ │   ├── __snapshots__
│ │ │ │   │ ├── assistant-prefix.test.ts.snap
│ │ │ │   │ ├── budget-cutoff.test.ts.snap
│ │ │ │   │ ├── conditional-slots.test.ts.snap
│ │ │ │   │ ├── determinism.test.ts.snap
│ │ │ │   │ ├── slot-priority.test.ts.snap
│ │ │ │   │ └── step-chaining.test.ts.snap
│ │ │ │   ├── step-chaining.test.ts
│ │ │ │   └── transform-chains.test.ts
│ │ │ ├── types.ts
│ │ │ ├── validator.test.ts
│ │ │ ├── validator.ts
│ │ │ ├── version.ts
│ │ │ ├── walkers.test.ts
│ │ │ └── walkers.ts
│ │ ├── tsconfig.build.json
│ │ ├── tsconfig.json
│ │ └── vitest.config.ts
│ ├── schemas
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── contracts
│ │ │ │ ├── character.ts
│ │ │ │ ├── chat-import.ts
│ │ │ │ ├── play.ts
│ │ │ │ ├── provider.ts
│ │ │ │ ├── scenario.ts
│ │ │ │ └── templates.ts
│ │ │ ├── index.ts
│ │ │ └── utils
│ │ │   └── data-uri-validation.ts
│ │ ├── tsconfig.build.json
│ │ └── tsconfig.json
│ ├── utils
│ │ ├── package.json
│ │ ├── src
│ │ │ ├── assert-defined.ts
│ │ │ ├── exact-keys.ts
│ │ │ ├── fractional-order.ts
│ │ │ ├── index.ts
│ │ │ ├── is-defined.ts
│ │ │ ├── lexo-order.ts
│ │ │ ├── result.ts
│ │ │ └── safe-json-parse.ts
│ │ ├── tsconfig.build.json
│ │ └── tsconfig.json
│ └── yolo-onnx
│   ├── models
│   │ ├── nms-yolov8.onnx
│   │ └── yolov8n-face.onnx
│   ├── package.json
│   ├── src
│   │ ├── index.ts
│   │ └── test-face-detection.ts
│   ├── tsconfig.build.json
│   └── tsconfig.json
├── pnpm-lock.yaml
├── pnpm-workspace.yaml
└── tsconfig.base.json

91 directories, 379 files
